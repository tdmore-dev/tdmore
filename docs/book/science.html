<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Science | TDMore: an R package for in silico assessment of dose individualization strategies</title>
  <meta name="description" content="TDMore reference manual" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Science | TDMore: an R package for in silico assessment of dose individualization strategies" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="TDMore reference manual" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Science | TDMore: an R package for in silico assessment of dose individualization strategies" />
  
  <meta name="twitter:description" content="TDMore reference manual" />
  

<meta name="author" content="Ruben Faelens, Nicolas Luyckx, Quentin Leirens, Thomas Bouillon" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tdmore-api.html">
<link rel="next" href="validation.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<meta name="robots" content="noindex" />


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">TDMore bookdown</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome to TDMore</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#about-this-book"><i class="fa fa-check"></i>About this book</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="legal-notices.html"><a href="legal-notices.html"><i class="fa fa-check"></i><b>1</b> Legal Notices</a><ul>
<li class="chapter" data-level="1.1" data-path="legal-notices.html"><a href="legal-notices.html#disclaimer"><i class="fa fa-check"></i><b>1.1</b> Disclaimer</a></li>
<li class="chapter" data-level="1.2" data-path="legal-notices.html"><a href="legal-notices.html#content"><i class="fa fa-check"></i><b>1.2</b> Content</a></li>
<li class="chapter" data-level="1.3" data-path="legal-notices.html"><a href="legal-notices.html#referrals-and-links"><i class="fa fa-check"></i><b>1.3</b> Referrals and links</a></li>
<li class="chapter" data-level="1.4" data-path="legal-notices.html"><a href="legal-notices.html#copyright"><i class="fa fa-check"></i><b>1.4</b> Copyright</a></li>
<li class="chapter" data-level="1.5" data-path="legal-notices.html"><a href="legal-notices.html#legal-validity-of-this-disclaimer"><i class="fa fa-check"></i><b>1.5</b> Legal validity of this disclaimer</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#prereq"><i class="fa fa-check"></i><b>2.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="install.html"><a href="install.html"><i class="fa fa-check"></i><b>3</b> Installation</a></li>
<li class="chapter" data-level="4" data-path="installation-script.html"><a href="installation-script.html"><i class="fa fa-check"></i><b>4</b> Installation script</a></li>
<li class="chapter" data-level="5" data-path="license.html"><a href="license.html"><i class="fa fa-check"></i><b>5</b> License</a></li>
<li class="chapter" data-level="6" data-path="tdmore-api.html"><a href="tdmore-api.html"><i class="fa fa-check"></i><b>6</b> TDMore API</a><ul>
<li class="chapter" data-level="6.1" data-path="tdmore-api.html"><a href="tdmore-api.html#model"><i class="fa fa-check"></i><b>6.1</b> Model definition</a><ul>
<li class="chapter" data-level="6.1.1" data-path="tdmore-api.html"><a href="tdmore-api.html#build-a-tdmore-object-from-a-nlxmir-model"><i class="fa fa-check"></i><b>6.1.1</b> Build a TDMore object from a nlxmir model</a></li>
<li class="chapter" data-level="6.1.2" data-path="tdmore-api.html"><a href="tdmore-api.html#build-a-tdmore-object-from-an-rxode-model"><i class="fa fa-check"></i><b>6.1.2</b> Build a TDMore object from an RxODE model</a></li>
<li class="chapter" data-level="6.1.3" data-path="tdmore-api.html"><a href="tdmore-api.html#build-your-own-algebraic-model"><i class="fa fa-check"></i><b>6.1.3</b> Build your own algebraic model</a></li>
<li class="chapter" data-level="6.1.4" data-path="tdmore-api.html"><a href="tdmore-api.html#add-model-covariates"><i class="fa fa-check"></i><b>6.1.4</b> Add model covariates</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="tdmore-api.html"><a href="tdmore-api.html#regimen"><i class="fa fa-check"></i><b>6.2</b> Regimen definition</a></li>
<li class="chapter" data-level="6.3" data-path="tdmore-api.html"><a href="tdmore-api.html#model-simulation"><i class="fa fa-check"></i><b>6.3</b> Model simulation</a><ul>
<li class="chapter" data-level="6.3.1" data-path="tdmore-api.html"><a href="tdmore-api.html#predicttdmore"><i class="fa fa-check"></i><b>6.3.1</b> Predict a tdmore object</a></li>
<li class="chapter" data-level="6.3.2" data-path="tdmore-api.html"><a href="tdmore-api.html#predicttdmorefit"><i class="fa fa-check"></i><b>6.3.2</b> Predict a tdmorefit object</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="tdmore-api.html"><a href="tdmore-api.html#estimation"><i class="fa fa-check"></i><b>6.4</b> Parameter estimation</a></li>
<li class="chapter" data-level="6.5" data-path="tdmore-api.html"><a href="tdmore-api.html#dose-recommendation"><i class="fa fa-check"></i><b>6.5</b> Dose recommendation</a><ul>
<li class="chapter" data-level="6.5.1" data-path="tdmore-api.html"><a href="tdmore-api.html#calling-the-finddose-method"><i class="fa fa-check"></i><b>6.5.1</b> Calling the findDose method</a></li>
<li class="chapter" data-level="6.5.2" data-path="tdmore-api.html"><a href="tdmore-api.html#visualise-a-recommendation"><i class="fa fa-check"></i><b>6.5.2</b> Visualise a recommendation</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="tdmore-api.html"><a href="tdmore-api.html#plotting-the-intermediate-steps"><i class="fa fa-check"></i><b>6.6</b> Plotting the intermediate steps</a><ul>
<li class="chapter" data-level="6.6.1" data-path="tdmore-api.html"><a href="tdmore-api.html#plotting-a-tdmore-object"><i class="fa fa-check"></i><b>6.6.1</b> Plotting a tdmore object</a></li>
<li class="chapter" data-level="6.6.2" data-path="tdmore-api.html"><a href="tdmore-api.html#plotting-a-tdmorefit-object"><i class="fa fa-check"></i><b>6.6.2</b> Plotting a tdmorefit object</a></li>
<li class="chapter" data-level="6.6.3" data-path="tdmore-api.html"><a href="tdmore-api.html#plotting-a-tdmorefit-object-with-an-adapted-regimen"><i class="fa fa-check"></i><b>6.6.3</b> Plotting a tdmorefit object with an adapted regimen</a></li>
<li class="chapter" data-level="6.6.4" data-path="tdmore-api.html"><a href="tdmore-api.html#plotting-a-tdmoreprofile-object"><i class="fa fa-check"></i><b>6.6.4</b> Plotting a tdmoreprofile object</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="tdmore-api.html"><a href="tdmore-api.html#extending-tdmore"><i class="fa fa-check"></i><b>6.7</b> Extending TDMore</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="science.html"><a href="science.html"><i class="fa fa-check"></i><b>7</b> Science</a><ul>
<li class="chapter" data-level="7.1" data-path="science.html"><a href="science.html#emperical-bayesian-estimation"><i class="fa fa-check"></i><b>7.1</b> Emperical Bayesian Estimation</a></li>
<li class="chapter" data-level="7.2" data-path="science.html"><a href="science.html#predictive-performance"><i class="fa fa-check"></i><b>7.2</b> Predictive performance</a></li>
<li class="chapter" data-level="7.3" data-path="science.html"><a href="science.html#predictive-performance-vs-dose-adaptation"><i class="fa fa-check"></i><b>7.3</b> Predictive performance vs dose adaptation</a><ul>
<li class="chapter" data-level="7.3.1" data-path="science.html"><a href="science.html#definitions"><i class="fa fa-check"></i><b>7.3.1</b> Definitions</a></li>
<li class="chapter" data-level="7.3.2" data-path="science.html"><a href="science.html#simple-curve-fitting"><i class="fa fa-check"></i><b>7.3.2</b> Simple curve fitting</a></li>
<li class="chapter" data-level="7.3.3" data-path="science.html"><a href="science.html#empirical-bayesian-estimation"><i class="fa fa-check"></i><b>7.3.3</b> Empirical bayesian estimation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="validation.html"><a href="validation.html"><i class="fa fa-check"></i><b>8</b> Validation</a><ul>
<li class="chapter" data-level="8.1" data-path="validation.html"><a href="validation.html#development-process"><i class="fa fa-check"></i><b>8.1</b> Development process</a></li>
<li class="chapter" data-level="8.2" data-path="validation.html"><a href="validation.html#standards-iec-623042006"><i class="fa fa-check"></i><b>8.2</b> Standards: IEC 62304:2006</a></li>
<li class="chapter" data-level="8.3" data-path="validation.html"><a href="validation.html#validation-requirements"><i class="fa fa-check"></i><b>8.3</b> Validation requirements</a><ul>
<li class="chapter" data-level="8.3.1" data-path="validation.html"><a href="validation.html#valid-clinical-association"><i class="fa fa-check"></i><b>8.3.1</b> Valid Clinical Association</a></li>
<li class="chapter" data-level="8.3.2" data-path="validation.html"><a href="validation.html#analytical-validation"><i class="fa fa-check"></i><b>8.3.2</b> Analytical Validation</a></li>
<li class="chapter" data-level="8.3.3" data-path="validation.html"><a href="validation.html#clinical-validation"><i class="fa fa-check"></i><b>8.3.3</b> Clinical Validation</a></li>
<li class="chapter" data-level="8.3.4" data-path="validation.html"><a href="validation.html#other-requirements"><i class="fa fa-check"></i><b>8.3.4</b> Other requirements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="vignettes.html"><a href="vignettes.html"><i class="fa fa-check"></i><b>9</b> Vignettes</a><ul>
<li class="chapter" data-level="9.1" data-path="vignettes.html"><a href="vignettes.html#running-tdmore"><i class="fa fa-check"></i><b>9.1</b> Running TDMore</a><ul>
<li class="chapter" data-level="" data-path="vignettes.html"><a href="vignettes.html#creating-your-model"><i class="fa fa-check"></i>Creating your model</a></li>
<li class="chapter" data-level="" data-path="vignettes.html"><a href="vignettes.html#predicting-new-data"><i class="fa fa-check"></i>Predicting new data</a></li>
<li class="chapter" data-level="" data-path="vignettes.html"><a href="vignettes.html#estimating-individual-parameters"><i class="fa fa-check"></i>Estimating individual parameters</a></li>
<li class="chapter" data-level="" data-path="vignettes.html"><a href="vignettes.html#finding-the-right-dose-to-give"><i class="fa fa-check"></i>Finding the right dose to give</a></li>
<li class="chapter" data-level="9.1.1" data-path="vignettes.html"><a href="vignettes.html#code-appendix"><i class="fa fa-check"></i><b>9.1.1</b> Code appendix</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="vignettes.html"><a href="vignettes.html#multiple-endpoints"><i class="fa fa-check"></i><b>9.2</b> Multiple endpoints</a><ul>
<li class="chapter" data-level="" data-path="vignettes.html"><a href="vignettes.html#writing-and-testing-the-pk-model"><i class="fa fa-check"></i>Writing and testing the PK model</a></li>
<li class="chapter" data-level="" data-path="vignettes.html"><a href="vignettes.html#adding-a-pd-model"><i class="fa fa-check"></i>Adding a PD model</a></li>
<li class="chapter" data-level="" data-path="vignettes.html"><a href="vignettes.html#estimating-individual-parameters-1"><i class="fa fa-check"></i>Estimating individual parameters</a></li>
<li class="chapter" data-level="9.2.1" data-path="vignettes.html"><a href="vignettes.html#code-appendix-1"><i class="fa fa-check"></i><b>9.2.1</b> Code appendix</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="vignettes.html"><a href="vignettes.html#example-detecting-non-adherence"><i class="fa fa-check"></i><b>9.3</b> Example: Detecting non-adherence</a><ul>
<li class="chapter" data-level="" data-path="vignettes.html"><a href="vignettes.html#about-this-example"><i class="fa fa-check"></i>About this example</a></li>
<li class="chapter" data-level="" data-path="vignettes.html"><a href="vignettes.html#the-model"><i class="fa fa-check"></i>The model</a></li>
<li class="chapter" data-level="" data-path="vignettes.html"><a href="vignettes.html#is-the-subject-taking-hisher-medication"><i class="fa fa-check"></i>Is the subject taking his/her medication?</a></li>
<li class="chapter" data-level="9.3.1" data-path="vignettes.html"><a href="vignettes.html#code-appendix-2"><i class="fa fa-check"></i><b>9.3.1</b> Code appendix</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><code>TDMore</code>: an R package for in silico assessment of dose individualization strategies</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="science" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Science</h1>
<p>This chapter reviews the main scientific basis behind TDMore</p>
<div id="emperical-bayesian-estimation" class="section level2">
<h2><span class="header-section-number">7.1</span> Emperical Bayesian Estimation</h2>
<p>TODO</p>
</div>
<div id="predictive-performance" class="section level2">
<h2><span class="header-section-number">7.2</span> Predictive performance</h2>
</div>
<div id="predictive-performance-vs-dose-adaptation" class="section level2">
<h2><span class="header-section-number">7.3</span> Predictive performance vs dose adaptation</h2>
<div id="definitions" class="section level3">
<h3><span class="header-section-number">7.3.1</span> Definitions</h3>
<p>Let us use a concrete example to evaluate whether predictive performance matches dose adaptation performance.</p>
<p>Our model is defined as follows</p>
<p><span class="math display">\[
C = \frac{D}{V} e^{-k(t-t_D)}
\]</span></p>
<p>For multiple doses:</p>
<p><span class="math display">\[
C = \sum\frac{D_i}{V} e^{-k(t-t_{D_i})}
\]</span></p>
<p>We define a very simple IIV model: <span class="math inline">\(V = \theta_V\)</span> and <span class="math inline">\(k = \theta_k (1+\eta_k)\)</span>. We will call this single <span class="math inline">\(\eta_k\)</span> simply <span class="math inline">\(\eta\)</span>.
Our residual error model is absolute: <span class="math inline">\(C = Y + \epsilon\)</span></p>
</div>
<div id="simple-curve-fitting" class="section level3">
<h3><span class="header-section-number">7.3.2</span> Simple curve fitting</h3>
<p>We could simply fit the curve. Assuming we have a single dose, and a single measured concentration:</p>
<p><span class="math display">\[
\begin{aligned}
C_0 &amp;= \frac{D}{V} e^{-k(t_0-t_D)} \\
  &amp;= \frac{D}{V} e^{-\theta_k(1+\eta)(t_0-t_D)} \\
log(C_0) &amp;= log(D/V) -\theta_k(1+\eta)(t_0-t_D) \\
\frac{log(C_0) - log(D/V)}{-\theta_k(t_0-t_D)} &amp;= (1+\eta) \\
\frac{log(C_0) - log(D/V)}{-\theta_k(t_0-t_D)} - 1 &amp;= \eta \\
\end{aligned}
\]</span></p>
<p>However, this does not take into account that there might be residual error in the measurement. We should use bayesian curve fitting instead.</p>
</div>
<div id="empirical-bayesian-estimation" class="section level3">
<h3><span class="header-section-number">7.3.3</span> Empirical bayesian estimation</h3>
<p>Let’s define the likelihood for a given eta, assuming we have measured a concentration <span class="math inline">\(C_0\)</span> at time <span class="math inline">\(t_0\)</span>:</p>
<p><span class="math display">\[
L = \Phi(\eta, 0, \omega) * \Phi(\epsilon, 0, \sigma) \\
with \\
C = Y + \epsilon \\
\epsilon = C-Y
\]</span></p>
<p>Let us fill in the likelihood for a normal distribution <span class="math inline">\(\Phi(x|\mu,\sigma) = \frac{1}{\sqrt{2\pi\sigma^2}} e^{-\frac{(x-\mu)^2}{2\sigma^2}}\)</span>. We immediately use the Log-likelihood, and drop any terms that are not influenced by <span class="math inline">\(\eta\)</span>.</p>
<p><span class="math display">\[
\begin{aligned}
LL &amp;= \frac{\eta^2}{2\omega^2}+ \frac{\epsilon^2}{2\sigma^2} \\
 &amp;= \frac{\eta^2}{2\omega^2}+ \frac{\epsilon^2}{2\sigma^2}
\end{aligned}
\]</span></p>
<p>We now find the optimum, which is at the point where the derivative is 0.</p>
<p><span class="math display">\[
\frac{dLL}{d\eta} = \frac{2\eta}{2\omega^2}+ \frac{2\epsilon}{2\sigma^2} \frac{d\epsilon}{d\eta}
\]</span></p>
<p>We calculate <span class="math inline">\(\frac{d\epsilon^2}{d\eta}\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{d\epsilon}{d\eta} &amp;= \frac{d}{d\eta} \left(   C-Y    \right) \\
 &amp;= -\frac{dY}{d\eta} \\
 &amp;= -\frac{d}{d\eta}\left( \frac{D}{V} e^{-\theta_k(1+\eta)(t-t_D)}  \right) \\
 &amp;= -\frac{D}{V} e^{-\theta_k(1+\eta)(t-t_D)} \frac{d}{d\eta}\left(  -\theta_k(1+\eta)(t-t_D)  \right) \\
 &amp;= \frac{D}{V} e^{-\theta_k(1+\eta)(t-t_D)} \theta_k (t-t_D)
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
\frac{dLL}{d\eta} &amp;= \frac{2\eta}{2\omega^2}+ \frac{2\epsilon}{2\sigma^2} \frac{d\epsilon}{d\eta} \\
 &amp;= \frac{\eta}{\omega^2}+ \frac{2\epsilon}{2\sigma^2} Y\theta_k(t-tD) \\
 &amp;= \frac{\eta}{\omega^2}+ \frac{1}{\sigma^2} (C-Y)Y\theta_k(t-tD) \\
 &amp;= 0 \  at\  maximum
\end{aligned}
\]</span></p>
<p>Even using the simplest possible model, the above equation does not have an analytical solution.</p>
<p>Instead, we can explore how parameter estimates (and model predictions) change in function of different parameter values. We use a proportional error model and lognormal IIV, to be more realistic.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1">TVk &lt;-<span class="st"> </span><span class="fl">0.1</span> <span class="co">#/h</span></a>
<a class="sourceLine" id="cb46-2" title="2">V &lt;-<span class="st"> </span><span class="dv">10</span> <span class="co">#L</span></a>
<a class="sourceLine" id="cb46-3" title="3">D &lt;-<span class="st"> </span><span class="dv">10</span> <span class="co">#mg</span></a>
<a class="sourceLine" id="cb46-4" title="4">omega=<span class="fl">0.40</span> <span class="co">#lognormal</span></a>
<a class="sourceLine" id="cb46-5" title="5">sigma=<span class="fl">0.15</span> <span class="co">#proportional</span></a>
<a class="sourceLine" id="cb46-6" title="6">t=<span class="dv">4</span> <span class="co">#4h post-dose</span></a>
<a class="sourceLine" id="cb46-7" title="7">predFun &lt;-<span class="st"> </span><span class="cf">function</span>(eta) tdmore<span class="op">::</span><span class="kw">pk1cptiv_</span>(<span class="dt">t=</span>t, <span class="dt">TIME=</span><span class="dv">0</span>, <span class="dt">AMT=</span>D, <span class="dt">V=</span>V, <span class="dt">K=</span>TVk<span class="op">*</span><span class="kw">exp</span>(eta)) <span class="op">*</span><span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb46-8" title="8"></a>
<a class="sourceLine" id="cb46-9" title="9">etaRange &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="dt">length.out=</span><span class="dv">200</span>)<span class="op">*</span>omega</a>
<a class="sourceLine" id="cb46-10" title="10"><span class="kw">ggplot</span>(<span class="kw">tibble</span>(<span class="dt">x=</span>etaRange<span class="op">/</span>omega, <span class="dt">y=</span><span class="kw">sapply</span>(etaRange, predFun)) ) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-11" title="11"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-12" title="12"><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;point&quot;</span>, <span class="dt">size=</span><span class="dv">2</span>, <span class="dt">x=</span><span class="dv">0</span>, <span class="dt">y=</span><span class="kw">predFun</span>(<span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-13" title="13"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;eta/omega&quot;</span>, <span class="dt">y=</span><span class="st">&quot;IPRED&quot;</span>, <span class="dt">title=</span><span class="st">&quot;Predicted concentration at one specific time-point&quot;</span>, <span class="dt">subtitle=</span><span class="st">&quot;Model is clearly non-linear&quot;</span>)</a></code></pre></div>
<p><img src="06-Scientific_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1"><span class="kw">ggplot</span>(<span class="kw">tibble</span>(<span class="dt">x=</span>etaRange<span class="op">/</span>omega, <span class="dt">y=</span><span class="kw">sapply</span>(etaRange, predFun)) ) <span class="op">+</span></a>
<a class="sourceLine" id="cb47-2" title="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>y, <span class="dt">y=</span>x)) <span class="op">+</span></a>
<a class="sourceLine" id="cb47-3" title="3"><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;point&quot;</span>, <span class="dt">size=</span><span class="dv">2</span>, <span class="dt">x=</span><span class="kw">predFun</span>(<span class="dv">0</span>), <span class="dt">y=</span><span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb47-4" title="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;eta/omega&quot;</span>, <span class="dt">x=</span><span class="st">&quot;IPRED&quot;</span>, <span class="dt">title=</span><span class="st">&quot;To make the model predict high concentrations, you have to pull really hard at eta_k&quot;</span>,</a>
<a class="sourceLine" id="cb47-5" title="5">       <span class="dt">subtitle=</span><span class="st">&quot;Logical; concentrations at t=4h can never exceed the initial concentration of 1000ng/mL!&quot;</span>)</a></code></pre></div>
<p><img src="06-Scientific_files/figure-html/unnamed-chunk-1-2.png" width="672" /></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1"><span class="co">## CurveFit comes up with the theoretical eta, disregarding omega/sigma entirely</span></a>
<a class="sourceLine" id="cb48-2" title="2">curveFit &lt;-<span class="st"> </span><span class="cf">function</span>(C) {</a>
<a class="sourceLine" id="cb48-3" title="3">  fun &lt;-<span class="st"> </span><span class="cf">function</span>(eta, C) {</a>
<a class="sourceLine" id="cb48-4" title="4">    Y &lt;-<span class="st"> </span><span class="kw">predFun</span>(eta)</a>
<a class="sourceLine" id="cb48-5" title="5">    epsilon &lt;-<span class="st">  </span>Y<span class="op">/</span>C <span class="dv">-1</span></a>
<a class="sourceLine" id="cb48-6" title="6">    epsilon<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb48-7" title="7">  }</a>
<a class="sourceLine" id="cb48-8" title="8">  res &lt;-<span class="st"> </span>stats<span class="op">::</span><span class="kw">optimize</span>(fun, <span class="dt">interval=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span><span class="op">*</span>omega, <span class="dv">10</span><span class="op">*</span>omega), <span class="dt">C=</span>C)</a>
<a class="sourceLine" id="cb48-9" title="9">  res<span class="op">$</span>minimum</a>
<a class="sourceLine" id="cb48-10" title="10">}</a>
<a class="sourceLine" id="cb48-11" title="11"></a>
<a class="sourceLine" id="cb48-12" title="12">testRange &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">4</span>, <span class="dv">4</span>, <span class="dt">length.out=</span><span class="dv">200</span>)<span class="op">*</span>omega</a>
<a class="sourceLine" id="cb48-13" title="13">sim &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tibble</span>( <span class="dt">trueEta =</span> testRange ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-14" title="14"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-15" title="15"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb48-16" title="16">    <span class="dt">C=</span><span class="kw">predFun</span>(trueEta),</a>
<a class="sourceLine" id="cb48-17" title="17">    <span class="dt">CurveFitEta =</span> <span class="kw">curveFit</span>(C),</a>
<a class="sourceLine" id="cb48-18" title="18">    <span class="dt">CurveFitIPRED =</span> <span class="kw">predFun</span>(CurveFitEta)</a>
<a class="sourceLine" id="cb48-19" title="19">  )</a>
<a class="sourceLine" id="cb48-20" title="20"><span class="kw">ggplot</span>(sim, <span class="kw">aes</span>(<span class="dt">x=</span>C, <span class="dt">y=</span>CurveFitIPRED)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_abline</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb48-21" title="21"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;DV&quot;</span>, <span class="dt">y=</span><span class="st">&quot;IPRED&quot;</span>, <span class="dt">title=</span><span class="st">&quot;When curve fitting, IPRED perfectly matches points&quot;</span>)</a></code></pre></div>
<p><img src="06-Scientific_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1">ll &lt;-<span class="st"> </span><span class="cf">function</span>(eta, C, <span class="dt">pop=</span>F, <span class="dt">pred=</span>F) {</a>
<a class="sourceLine" id="cb49-2" title="2">    Y &lt;-<span class="st"> </span><span class="kw">predFun</span>(eta)</a>
<a class="sourceLine" id="cb49-3" title="3">    epsilon &lt;-<span class="st"> </span>Y<span class="op">/</span>C <span class="dv">-1</span></a>
<a class="sourceLine" id="cb49-4" title="4">    LLpop &lt;-<span class="st"> </span><span class="kw">dnorm</span>(eta, <span class="dv">0</span>, omega, <span class="dt">log=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb49-5" title="5">    LLpred &lt;-<span class="st"> </span><span class="kw">dnorm</span>(epsilon, <span class="dv">0</span>, sigma, <span class="dt">log=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb49-6" title="6">    <span class="cf">if</span>(pop) <span class="kw">return</span>(LLpop)</a>
<a class="sourceLine" id="cb49-7" title="7">    <span class="cf">if</span>(pred) <span class="kw">return</span>(LLpred)</a>
<a class="sourceLine" id="cb49-8" title="8">    <span class="kw">return</span>(<span class="op">-</span><span class="dv">2</span><span class="op">*</span>(LLpop <span class="op">+</span><span class="st"> </span>LLpred))</a>
<a class="sourceLine" id="cb49-9" title="9">}</a>
<a class="sourceLine" id="cb49-10" title="10">etaFun &lt;-<span class="st"> </span><span class="cf">function</span>(C) {</a>
<a class="sourceLine" id="cb49-11" title="11">  res &lt;-<span class="st"> </span>stats<span class="op">::</span><span class="kw">optimize</span>(ll, <span class="dt">interval=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>)<span class="op">*</span>omega, <span class="dt">C=</span>C)</a>
<a class="sourceLine" id="cb49-12" title="12">  res<span class="op">$</span>minimum</a>
<a class="sourceLine" id="cb49-13" title="13">}</a>
<a class="sourceLine" id="cb49-14" title="14"></a>
<a class="sourceLine" id="cb49-15" title="15">sim &lt;-<span class="st"> </span>sim <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb49-16" title="16">  <span class="dt">ebeEta =</span> <span class="kw">etaFun</span>(C),</a>
<a class="sourceLine" id="cb49-17" title="17">  <span class="dt">ebeIPRED =</span> <span class="kw">predFun</span>(ebeEta)</a>
<a class="sourceLine" id="cb49-18" title="18">)</a>
<a class="sourceLine" id="cb49-19" title="19"></a>
<a class="sourceLine" id="cb49-20" title="20"><span class="kw">ggplot</span>(sim, <span class="kw">aes</span>(<span class="dt">y=</span>C)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb49-21" title="21"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x=</span>CurveFitIPRED, <span class="dt">ymin=</span>C<span class="op">-</span>sigma<span class="op">*</span>C, <span class="dt">ymax=</span>C<span class="op">+</span>sigma<span class="op">*</span>C), <span class="dt">fill=</span><span class="st">&#39;green&#39;</span>, <span class="dt">alpha=</span><span class="fl">0.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb49-22" title="22"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>CurveFitIPRED, <span class="dt">color=</span>CurveFitEta<span class="op">/</span>omega), <span class="dt">lwd=</span><span class="fl">1.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb49-23" title="23"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>ebeIPRED, <span class="dt">color=</span>ebeEta<span class="op">/</span>omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb49-24" title="24"><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb49-25" title="25"><span class="st">  </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb49-26" title="26"><span class="st">  </span><span class="kw">scale_color_gradient2</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb49-27" title="27"><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;point&quot;</span>, <span class="dt">size=</span><span class="dv">2</span>, <span class="dt">x=</span><span class="kw">predFun</span>(<span class="dv">0</span>), <span class="dt">y=</span><span class="kw">predFun</span>(<span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb49-28" title="28"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb49-29" title="29"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;DV&quot;</span>, <span class="dt">x=</span><span class="st">&quot;IPRED&quot;</span>, <span class="dt">title=</span><span class="st">&quot;EBE estimates regress to the mean&quot;</span>,</a>
<a class="sourceLine" id="cb49-30" title="30">       <span class="dt">subtitle=</span><span class="st">&quot;Green area shows residual error (+-1 sigma)&quot;</span>,</a>
<a class="sourceLine" id="cb49-31" title="31">       <span class="dt">color=</span><span class="kw">expression</span>(<span class="kw">frac</span>(eta, omega)),</a>
<a class="sourceLine" id="cb49-32" title="32">       <span class="dt">caption=</span><span class="st">&quot;Curved line shows concentrations by EBE fitting. Dot corresponds to typical concentration&quot;</span>)</a></code></pre></div>
<p><img src="06-Scientific_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1"><span class="kw">ggplot</span>(sim, <span class="kw">aes</span>(<span class="dt">x=</span>C)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb50-2" title="2"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="dv">0</span>, <span class="dt">linetype=</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb50-3" title="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>CurveFitEta)) <span class="op">+</span></a>
<a class="sourceLine" id="cb50-4" title="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y=</span>ebeEta, <span class="dt">color=</span>ebeIPRED<span class="op">/</span>C <span class="dv">-1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb50-5" title="5"><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;point&quot;</span>, <span class="dt">size=</span><span class="dv">2</span>, <span class="dt">x=</span><span class="kw">predFun</span>(<span class="dv">0</span>), <span class="dt">y=</span><span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb50-6" title="6"><span class="st">  </span><span class="kw">scale_color_gradient2</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb50-7" title="7"><span class="co">#  scale_x_log10() +</span></a>
<a class="sourceLine" id="cb50-8" title="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;DV&quot;</span>,</a>
<a class="sourceLine" id="cb50-9" title="9">       <span class="dt">y=</span><span class="kw">expression</span>(eta),</a>
<a class="sourceLine" id="cb50-10" title="10">       <span class="dt">color=</span><span class="kw">expression</span>(epsilon),</a>
<a class="sourceLine" id="cb50-11" title="11">       <span class="dt">title=</span><span class="st">&quot;EBE estimates regress to the mean&quot;</span>,</a>
<a class="sourceLine" id="cb50-12" title="12">       <span class="dt">subtitle=</span><span class="st">&quot;Low concentrations require little adjustment on ETA to hit</span></a>
<a class="sourceLine" id="cb50-13" title="13"><span class="st">High concentrations are difficult and require massive ETA changes.&quot;</span></a>
<a class="sourceLine" id="cb50-14" title="14">  )</a></code></pre></div>
<p><img src="06-Scientific_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<p>Let’s analyse the behaviour for low concentrations and high concentrations</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1">llProfile &lt;-<span class="st"> </span><span class="cf">function</span>(C, <span class="dt">interval=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">4</span>, <span class="dv">4</span>)<span class="op">*</span>omega) {</a>
<a class="sourceLine" id="cb51-2" title="2">  etaRange &lt;-<span class="st"> </span><span class="kw">seq</span>(interval[<span class="dv">1</span>], interval[<span class="dv">2</span>], <span class="dt">length.out=</span><span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb51-3" title="3">  tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="dt">eta=</span>etaRange, </a>
<a class="sourceLine" id="cb51-4" title="4">                 <span class="dt">OFV=</span><span class="kw">sapply</span>(etaRange, ll, C), </a>
<a class="sourceLine" id="cb51-5" title="5">                 <span class="dt">LLpop=</span><span class="kw">sapply</span>(etaRange, ll, C, <span class="dt">pop=</span>T), </a>
<a class="sourceLine" id="cb51-6" title="6">                 <span class="dt">LLpred=</span><span class="kw">sapply</span>(etaRange, ll, C, <span class="dt">pred=</span>T),</a>
<a class="sourceLine" id="cb51-7" title="7">                 <span class="dt">etaHat=</span><span class="kw">etaFun</span>(C),</a>
<a class="sourceLine" id="cb51-8" title="8">                 <span class="dt">OFVHat=</span><span class="kw">ll</span>(etaHat, C))</a>
<a class="sourceLine" id="cb51-9" title="9">}</a>
<a class="sourceLine" id="cb51-10" title="10"></a>
<a class="sourceLine" id="cb51-11" title="11">CONCTest=<span class="kw">c</span>(<span class="dv">250</span>, <span class="dv">300</span>, <span class="dv">500</span>, <span class="dv">750</span>, <span class="dv">900</span>)</a>
<a class="sourceLine" id="cb51-12" title="12"><span class="kw">tibble</span>(<span class="dt">C=</span>CONCTest) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(C) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_modify</span>(<span class="op">~</span><span class="kw">llProfile</span>(.y<span class="op">$</span>C)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-13" title="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>eta<span class="op">/</span>omega)) <span class="op">+</span></a>
<a class="sourceLine" id="cb51-14" title="14"><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun=</span><span class="op">~</span><span class="kw">dnorm</span>(.x<span class="op">/</span>omega, <span class="dt">log=</span>T)) <span class="op">+</span></a>
<a class="sourceLine" id="cb51-15" title="15"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>LLpop<span class="op">+</span>LLpred, <span class="dt">group=</span>C, <span class="dt">color=</span><span class="kw">factor</span>(C))) <span class="op">+</span></a>
<a class="sourceLine" id="cb51-16" title="16"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>LLpred, <span class="dt">group=</span>C, <span class="dt">color=</span><span class="kw">factor</span>(C)), <span class="dt">linetype=</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb51-17" title="17"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span>etaHat<span class="op">/</span>omega, <span class="dt">y=</span>OFVHat<span class="op">/-</span><span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb51-18" title="18"><span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x=</span>etaHat<span class="op">/</span>omega, <span class="dt">y=</span>OFVHat<span class="op">/-</span><span class="dv">2</span>, <span class="dt">xend=</span><span class="kw">stat</span>(x), <span class="dt">yend=</span><span class="ot">Inf</span>, <span class="dt">color=</span><span class="kw">factor</span>(C))) <span class="op">+</span></a>
<a class="sourceLine" id="cb51-19" title="19"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim=</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">4</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb51-20" title="20"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Standardized ETA&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Log-likelihood&quot;</span>, <span class="dt">color=</span><span class="st">&quot;Observed concentration&quot;</span>,</a>
<a class="sourceLine" id="cb51-21" title="21">       <span class="dt">title=</span><span class="st">&quot;Overall log-likelihood is the sum of population LL and observation LL&quot;</span>,</a>
<a class="sourceLine" id="cb51-22" title="22">       <span class="dt">subtitle=</span><span class="st">&quot;This pulls the estimate towards the mean</span><span class="ch">\n</span><span class="st">How much depends on how certain the eta is compared to the RE model&quot;</span>)</a></code></pre></div>
<p><img src="06-Scientific_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1"><span class="kw">ggplot</span>(sim) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb52-2" title="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">dnorm</span>(ebeEta<span class="op">/</span>omega, <span class="dt">log=</span>T), </a>
<a class="sourceLine" id="cb52-3" title="3">                 <span class="dt">y=</span><span class="kw">dnorm</span>((ebeIPRED<span class="op">/</span>C <span class="dv">-1</span>)<span class="op">/</span>sigma, <span class="dt">log=</span>T),</a>
<a class="sourceLine" id="cb52-4" title="4">                 <span class="dt">color=</span>C</a>
<a class="sourceLine" id="cb52-5" title="5">                 )) <span class="op">+</span></a>
<a class="sourceLine" id="cb52-6" title="6"><span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;point&quot;</span>, <span class="dt">x=</span><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dt">log=</span>T), <span class="dt">y=</span><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dt">log=</span>T)) <span class="op">+</span></a>
<a class="sourceLine" id="cb52-7" title="7"><span class="st">  </span><span class="kw">scale_color_gradient2</span>(<span class="dt">midpoint=</span><span class="kw">predFun</span>(<span class="dv">0</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb52-8" title="8"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;LL_pop&quot;</span>, <span class="dt">y=</span><span class="st">&quot;LL_pred&quot;</span>, <span class="dt">title=</span><span class="st">&quot;Do we pick an eta that nicely splits LL between LL_pop and LL_pred?&quot;</span>,</a>
<a class="sourceLine" id="cb52-9" title="9">       <span class="dt">subtitle=</span><span class="st">&quot;For high concentrations, LL_pop is maintained and we accept a reduced LL_pred.</span></a>
<a class="sourceLine" id="cb52-10" title="10"><span class="st">For low concentrations, LL_pred is maintained and we accept a reduced LL_pop.</span></a>
<a class="sourceLine" id="cb52-11" title="11"><span class="st">Direct result of non-linear model.&quot;</span></a>
<a class="sourceLine" id="cb52-12" title="12">       ) <span class="op">+</span></a>
<a class="sourceLine" id="cb52-13" title="13"><span class="st">  </span><span class="kw">coord_fixed</span>()</a></code></pre></div>
<p><img src="06-Scientific_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1"><span class="kw">ggplot</span>(sim, <span class="kw">aes</span>(<span class="dt">x=</span>ebeEta<span class="op">/</span>omega)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb53-2" title="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y=</span><span class="kw">dnorm</span>(ebeEta<span class="op">/</span>omega), <span class="dt">color=</span><span class="st">&quot;Phi_pop&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb53-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y=</span><span class="kw">dnorm</span>((ebeIPRED<span class="op">/</span>C <span class="dv">-1</span>)<span class="op">/</span>sigma), <span class="dt">color=</span><span class="st">&quot;Phi_pred&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb53-4" title="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y=</span><span class="kw">dnorm</span>(ebeEta<span class="op">/</span>omega)<span class="op">*</span><span class="kw">dnorm</span>((ebeIPRED<span class="op">/</span>C <span class="dv">-1</span>)<span class="op">/</span>sigma), <span class="dt">color=</span><span class="st">&quot;Phi&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb53-5" title="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Omega-normalized ETA&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Phi&quot;</span>, <span class="dt">color=</span><span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb53-6" title="6">       <span class="dt">title=</span><span class="st">&quot;Plot of EBE fit results&quot;</span>,</a>
<a class="sourceLine" id="cb53-7" title="7">       <span class="dt">subtitle=</span></a>
<a class="sourceLine" id="cb53-8" title="8"><span class="st">&quot;Low concentrations allow ETA to wander far, because the model can still fit them</span></a>
<a class="sourceLine" id="cb53-9" title="9"><span class="st">High concentrations keep an ETA close to mean, and LL_pred suffers.&quot;</span>)</a></code></pre></div>
<p><img src="06-Scientific_files/figure-html/unnamed-chunk-4-3.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tdmore-api.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="validation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
